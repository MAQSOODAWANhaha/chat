# 语言对话平台 - 需求文档

**版本：** v2.1 (实时版)
**日期：** 2025-10-29  
**文档类型：** 产品需求文档（PRD）

---

## 1. 项目概述

### 1.1 项目背景
语言学习者和多语言使用者需要一个能提供即时反馈、对话流畅自然的练习环境。现有的回合制对话工具延迟较高，无法模拟真实对话的沉浸感。

### 1.2 项目目标
开发一个**低延迟、高流畅度**的实时 AI 语音对话平台，提供接近真人对话体验的语音和文字练习。

### 1.3 目标用户
- 语言学习者
- 多语言使用者
- 需要场景化对话训练的用户
- 寻求自然、沉浸式 AI 对话体验的用户

---

## 2. 核心需求

### 2.1 关键特性

| 特性 | 说明 |
|------|------|
| **实时对话** | 支持流式语音输入输出，实现毫秒级响应 |
| **即开即用** | 无需注册登录 |
| **多语言支持** | 支持多种语言的输入输出 |
| **多角色对话** | 提供多个 AI 角色，适应不同场景 |
| **对话管理** | 支持多个对话会话并行 |
| **灵活配置** | 可自定义输出语言和显示模式 |
| **会话级存储** | 刷新页面清空所有数据 |

---

## 3. 用户需求

### 3.1 核心用户故事

| 作为 | 我想要 | 以便于 |
|------|--------|--------|
| 用户 | 进行流畅、低延迟的语音对话 | 获得像和真人聊天一样的沉浸感 |
| 用户 | 在我说话时，AI就能开始思考并准备回复 | 减少对话间的尴尬等待 |
| 用户 | 选择 AI 回复的语言 | 根据需要切换学习语言 |
| 用户 | 选择是否显示文字和播放语音 | 针对性训练（听力/阅读） |
| 用户 | 创建多个对话并随时切换 | 同时进行多个话题练习 |
| 用户 | 每个对话保持独立上下文 | AI 能记住对话历史 |
| 用户 | 选择不同的 AI 角色 | 模拟不同场景和风格 |
| 用户 | 刷新页面后数据清空 | 保护隐私 |

---

## 4. 功能需求

### 4.1 功能清单

#### 4.1.1 实时对话功能（P0）

| 功能 | 说明 | 验收标准 |
|------|------|---------|
| **流式语音输入** | 用户可以录音，音频流实时上传 | 客户端通过 WebSocket 实时发送音频数据 |
| **文字输入** | 用户可以键盘输入 | 支持多行输入，Enter 发送 |
| **实时 AI 对话** | 系统生成自然的对话回复 | 实现毫秒级响应，提供近乎真人的实时对话体验 |

#### 4.1.2 输出配置功能（P0）

| 功能 | 说明 | 验收标准 |
|------|------|---------|
| **输出语言选择** | 用户可选择 AI 回复的语言 | 支持2种语言（英语、中文） |
| **文字显示开关** | 用户可选择是否显示文字 | 实时生效，不影响历史消息 |
| **语音播放开关** | 用户可选择是否生成和播放语音 | 实时生效，不影响历史消息 |

**输出组合模式**：
- **默认模式**：文字 ✓ + 语音 ✓（综合训练）
- **听力模式**：文字 ✗ + 语音 ✓（专注听力）
- **阅读模式**：文字 ✓ + 语音 ✗（专注阅读）

#### 4.1.3 对话管理功能（P0）

| 功能 | 说明 | 验收标准 |
|------|------|---------|
| **新建对话** | 用户可创建新的对话会话 | 每个对话独立，互不干扰 |
| **对话列表** | 显示所有当前会话 | 清晰展示标题、角色、时间 |
| **切换对话** | 用户可在不同对话间切换 | 切换后显示完整历史 |
| **独立上下文** | 每个对话保持独立的对话历史 | AI 能记住当前对话的内容 |
| **会话级存储** | 数据仅在当前会话有效 | 刷新页面后所有数据清空 |
| **自动标题** | 系统自动生成对话标题 | 基于首条消息或对话内容 |

#### 4.1.4 角色系统功能（P0）

| 功能 | 说明 | 验收标准 |
|------|------|---------|
| **角色列表** | 提供多个预设 AI 角色 | 至少 5 个不同角色 |
| **角色选择** | 用户可在新建对话时选择角色 | 清晰展示角色特点 |
| **角色切换** | 用户可在对话中切换角色 | 切换后风格改变，历史保留 |

**预设角色**（至少包含）：
1. **通用助手** - 友好、耐心、全能
2. **语言教师** - 专业、纠错、鼓励
3. **商务顾问** - 正式、专业、高效
4. **聊天伙伴** - 轻松、幽默、随和
5. **旅游向导** - 热情、实用、文化交流

#### 4.1.5 界面功能（P0）

| 功能 | 说明 | 验收标准 |
|------|------|---------|
| **响应式设计** | 自动适配不同设备 | 手机、平板、电脑显示正常 |
| **消息展示** | 清晰展示对话历史 | 区分用户和 AI 消息 |
| **加载状态** | 显示处理中状态 | 所有异步操作有反馈 |

---

### 4.2 功能说明

#### 4.2.1 语音输入
- 用户点击麦克风按钮开始录音，音频数据以流的形式实时发送到后端。
- 录音中显示明显视觉反馈。
- 再次点击停止录音。

#### 4.2.2 输出配置
用户可以在设置面板中配置：
- **输出语言**：选择 AI 回复使用的语言（英语、中文、日语等）
- **显示文字**：开启/关闭文字显示
- **播放语音**：开启/关闭语音生成和播放

配置立即生效，仅影响后续消息。

#### 4.2.3 对话管理

**新建对话流程**：
1. 用户点击"新建对话"
2. 选择角色
3. 设置输出配置（可选）
4. 创建并自动切换到新对话

**对话切换**：
- 点击侧边栏对话列表中的任意对话
- 主界面切换到对应对话
- 保持该对话的历史和配置

**上下文隔离**：
- 每个对话有独立的消息历史
- AI 回复时只考虑当前对话的上下文
- 切换对话时，上下文完全隔离

**数据生命周期**：
- 数据仅存储在浏览器内存中
- 不使用 localStorage 或持久化存储
- 刷新页面或关闭标签页后，所有数据清空

#### 4.2.4 角色系统
- 每个角色有独特的性格、风格和专长
- 用户可在新建对话时选择角色
- 用户可在对话中途切换角色
- 切换角色后，AI 按新角色风格回复，保留对话历史

---

## 5. 界面需求

### 5.1 整体布局

**桌面端**：
- 左侧：对话列表侧边栏（260-300px）
- 右侧：当前对话界面（顶部角色信息、中间消息区、底部输入区）
- 右上角：配置按钮

**移动端**：
- 全屏单页面
- 左上角菜单按钮展开对话列表
- 顶部显示当前角色
- 中间消息区
- 底部输入区

### 5.2 关键界面

| 界面 | 包含元素 |
|------|---------|
| **对话列表** | 新建按钮、对话项（标题、角色、时间）、当前激活标识 |
| **对话主界面** | 角色信息栏、消息区、输入区（麦克风、输入框、发送） |
| **配置面板** | 输出语言选择、文字开关、语音开关 |
| **角色选择** | 角色列表、角色描述、选择按钮 |
| **消息气泡** | 用户消息（右侧蓝色）、AI 消息（左侧白色、可选语音条） |

---

## 6. 非功能需求

### 6.1 性能要求

| 指标 | 目标值 |
|------|--------|
| 页面首次加载 | < 2 秒 |
| 对话切换延迟 | < 300 毫秒 |
| **首字响应延迟** | **< 500 毫秒** (从用户结束说话到AI说出第一个字) |
| **端到端体验** | **实现流式对话，无明显回合等待感** |

### 6.2 兼容性要求

**支持的浏览器**：
- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+
- 移动端浏览器（iOS Safari、Chrome Android）

**支持的设备**：
- 桌面电脑（Windows、Mac、Linux）
- 智能手机（iOS、Android）
- 平板电脑

**屏幕适配**：
- 最小宽度：320px
- 响应式布局，自动适配

### 6.3 安全性要求

- API 密钥不在前端暴露
- 生产环境使用 HTTPS
- 限制音频文件上传大小（< 10MB）
- 不持久化用户数据，保护隐私

---

## 7. 验收标准

### 7.1 功能验收

| 验收项 | 标准 |
|--------|------|
| 实时语音对话 | 可以通过麦克风进行流畅的流式对话，AI响应迅速 |
| 输出语言设置 | 可选择语言，AI 用选定语言回复 |
| 文字/语音开关 | 可控制是否显示文字和播放语音 |
| 对话管理 | 可新建、切换多个对话，每个对话独立 |
| 角色系统 | 至少 5 个角色，可选择和切换 |
| 独立上下文 | 不同对话的上下文完全隔离 |
| 刷新清空 | 刷新页面后所有数据清空 |
| 响应式设计 | 在手机和电脑上显示正常 |

### 7.2 用户体验验收

| 验收项 | 标准 |
|--------|------|
| 易用性 | 新用户 1 分钟内完成首次对话 |
| 流畅度 | 对话过程无明显卡顿或等待 |
| 界面清晰 | 功能明确，不需要额外说明 |
| 错误提示 | 错误时有友好提示 |

---

## 8. 约束条件

### 8.1 技术约束
- 前端框架：React + TypeScript
- 后端框架：Axum (Rust)
- **核心通信**：**前端通过 WebSocket 与后端实时通信，后端作为网关代理到第三方实时语音服务。**
- 存储：仅内存存储，不使用数据库

### 8.2 实现约束
- ❌ 不实现用户注册/登录
- ❌ 不使用持久化存储（localStorage、数据库等）
- ❌ 不需要后台管理系统
- ✅ 必须支持移动端
- ✅ 必须支持语音功能

---

## 9. 里程碑

| 阶段 | 交付内容 | 预计时间 |
|------|---------|---------|
| **M1** | 基础对话功能（文字输入输出） | 2 天 |
| **M2** | 语音功能（输入、识别、播放） | 2 天 |
| **M3** | 对话管理和输出配置 | 1.5 天 |
| **M4** | 角色系统 | 1.5 天 |
| **M5** | UI 优化和测试 | 1 天 |

**总计：约 8 天**

---

## 10. 风险和依赖

| 风险 | 缓解措施 |
|------|---------|
| 实时语音 API 服务不稳定 | 添加心跳检测和断线重连机制，友好提示用户 |
| 浏览器不支持录音 API | 检测能力，提示用户升级 |
| 语音识别不准确 | 允许用户手动修改识别结果 |
| 弱网环境响应慢 | 优化加载体验，添加超时处理 |

---

## 附录：术语表

| 术语 | 解释 |
|------|------|
| **会话级存储** | 数据仅在当前浏览器会话有效，刷新即清空 |
| **上下文隔离** | 不同对话的历史记录互不影响 |
| **语音条** | 显示可播放语音的 UI 组件 |
| **角色** | 具有特定性格和风格的 AI 对话对象 |

---

**文档状态**: ✅ 待审批  
**文档版本**: v2.1
**最后更新**: 2025-10-29
